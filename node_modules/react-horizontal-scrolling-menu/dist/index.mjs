import e from"react";const t="react-horizontal-scrolling-menu",n=`${t}--item`,r=`${t}--scroll-container`,o=`${t}--wrapper`,s=`${t}--inner-wrapper`,i=`${t}--header`,l=`${t}--arrow-left`,a=`${t}--arrow-right`,u=`${t}--footer`,c="itemId",d="data-key",h="data-index",f={first:"first",last:"last",onInit:"onInit",onUpdate:"onUpdate"},v="",m={current:null};var p=Object.freeze({__proto__:null,rootClassName:t,itemClassName:n,scrollContainerClassName:r,wrapperClassName:o,innerWrapperClassName:s,headerClassName:i,arrowLeftClassName:l,arrowRightClassName:a,footerClassName:u,id:c,dataKeyAttribute:d,dataIndexAttribute:h,events:f,emptyStr:v,emptyRef:m});class b{constructor(){this.subscribe=(e,t)=>{this.observers.set(e,(this.observers.get(e)||[]).concat(t))},this.unsubscribe=(e,t)=>{const n=(this.observers.get(e)||[]).filter((e=>e!==t));n.length?this.observers.set(e,n):this.observers.delete(e)},this.emitUpdates=(e,t)=>{const n=this.observers.get(e)||[];null==n||n.forEach((e=>e(t)))},this.updateBatch=(e,t=!0)=>{e.length&&(e.forEach((([e,t])=>this.emitUpdates(e,t))),t&&this.emitUpdates(f.onUpdate))},this.update=(e,t)=>{this.emitUpdates(e,t),this.emitUpdates(f.onUpdate)},this.observers=new Map}}class g extends Map{constructor(){super(),this.subscribe=(e,t)=>this.observer.subscribe(e,t),this.unsubscribe=(e,t)=>this.observer.unsubscribe(e,t),this.isEdgeItem=({key:e,value:t,first:n=this.first(),last:r=this.last()})=>{const o=[];return e===(null==n?void 0:n.key)?o.push([f.first,t]):e===(null==r?void 0:r.key)&&o.push([f.last,t]),o},this.edgeItemsCheck=e=>{const t=this.first(),n=this.last(),r=e.find((([e])=>e===(null==t?void 0:t.key))),o=[];r&&o.push([f.first,r[1]]);const s=e.find((([e])=>e===(null==n?void 0:n.key)));return s&&o.push([f.last,s[1]]),o},this.toArr=()=>this.sort([...this]),this.toItems=()=>this.toArr().map((([e])=>e)),this.sort=e=>e.sort((([,e],[,t])=>+e.index-+t.index)),this.set=(e,t)=>{const n=String(e),r=[[n,t]];return super.set(n,t),r.push(...this.isEdgeItem({key:n,value:t,first:this.first(),last:this.last()})),this.observer.updateBatch(r),this},this.setBatch=e=>{this.firstRun&&this.observer.update(f.onInit);const t=[...e];return this.sort(t).forEach((([e,t])=>{super.set(String(e),t)})),t.push(...this.edgeItemsCheck(t)),this.observer.updateBatch(t,!this.firstRun),this.firstRun=!1,this},this.first=()=>{var e;return null===(e=this.toArr()[0])||void 0===e?void 0:e[1]},this.last=()=>{var e,t;return null===(t=null===(e=this.toArr().slice(-1))||void 0===e?void 0:e[0])||void 0===t?void 0:t[1]},this.filter=e=>this.toArr().filter(e),this.find=e=>this.toArr().find(e),this.findIndex=e=>this.toArr().findIndex(e),this.getCurrentPos=e=>{const t=this.toArr(),n=t.findIndex((([t,n])=>t===e||n===e));return[t,n]},this.prev=e=>{var t;const[n,r]=this.getCurrentPos(e);return-1!==r?null===(t=n[r-1])||void 0===t?void 0:t[1]:void 0},this.next=e=>{var t;const[n,r]=this.getCurrentPos(e);return-1!==r?null===(t=n[r+1])||void 0===t?void 0:t[1]:void 0},this.getVisible=()=>this.filter((e=>e[1].visible)),this.observer=new b,this.firstRun=!0}}const y=e=>"object"==typeof e&&null!=e&&1===e.nodeType,w=(e,t)=>(!t||"hidden"!==e)&&"visible"!==e&&"clip"!==e,C=(e,t)=>{if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){const n=getComputedStyle(e,null);return w(n.overflowY,t)||w(n.overflowX,t)||(e=>{const t=(e=>{if(!e.ownerDocument||!e.ownerDocument.defaultView)return null;try{return e.ownerDocument.defaultView.frameElement}catch(e){return null}})(e);return!!t&&(t.clientHeight<e.scrollHeight||t.clientWidth<e.scrollWidth)})(e)}return!1},M=(e,t,n,r,o,s,i,l)=>s<e&&i>t||s>e&&i<t?0:s<=e&&l<=n||i>=t&&l>=n?s-e-r:i>t&&l<n||s<e&&l>n?i-t+o:0,E=e=>{const t=e.parentElement;return null==t?e.getRootNode().host||null:t},I=(e,t)=>{var n,r,o,s;if("undefined"==typeof document)return[];const{scrollMode:i,block:l,inline:a,boundary:u,skipOverflowHiddenElements:c}=t,d="function"==typeof u?u:e=>e!==u;if(!y(e))throw new TypeError("Invalid target");const h=document.scrollingElement||document.documentElement,f=[];let v=e;for(;y(v)&&d(v);){if(v=E(v),v===h){f.push(v);break}null!=v&&v===document.body&&C(v)&&!C(document.documentElement)||null!=v&&C(v,c)&&f.push(v)}const m=null!=(r=null==(n=window.visualViewport)?void 0:n.width)?r:innerWidth,p=null!=(s=null==(o=window.visualViewport)?void 0:o.height)?s:innerHeight,{scrollX:b,scrollY:g}=window,{height:w,width:I,top:k,right:x,bottom:N,left:R}=e.getBoundingClientRect(),{top:S,right:T,bottom:$,left:O}=(e=>{const t=window.getComputedStyle(e);return{top:parseFloat(t.scrollMarginTop)||0,right:parseFloat(t.scrollMarginRight)||0,bottom:parseFloat(t.scrollMarginBottom)||0,left:parseFloat(t.scrollMarginLeft)||0}})(e);let B="start"===l||"nearest"===l?k-S:"end"===l?N+$:k+w/2-S+$,W="center"===a?R+I/2-O+T:"end"===a?x+T:R-O;const j=[];for(let e=0;e<f.length;e++){const t=f[e],{height:n,width:r,top:o,right:s,bottom:u,left:c}=t.getBoundingClientRect();if("if-needed"===i&&k>=0&&R>=0&&N<=p&&x<=m&&k>=o&&N<=u&&R>=c&&x<=s)return j;const d=getComputedStyle(t),v=parseInt(d.borderLeftWidth,10),y=parseInt(d.borderTopWidth,10),C=parseInt(d.borderRightWidth,10),E=parseInt(d.borderBottomWidth,10);let S=0,T=0;const $="offsetWidth"in t?t.offsetWidth-t.clientWidth-v-C:0,O="offsetHeight"in t?t.offsetHeight-t.clientHeight-y-E:0,H="offsetWidth"in t?0===t.offsetWidth?0:r/t.offsetWidth:0,L="offsetHeight"in t?0===t.offsetHeight?0:n/t.offsetHeight:0;if(h===t)S="start"===l?B:"end"===l?B-p:"nearest"===l?M(g,g+p,p,y,E,g+B,g+B+w,w):B-p/2,T="start"===a?W:"center"===a?W-m/2:"end"===a?W-m:M(b,b+m,m,v,C,b+W,b+W+I,I),S=Math.max(0,S+g),T=Math.max(0,T+b);else{S="start"===l?B-o-y:"end"===l?B-u+E+O:"nearest"===l?M(o,u,n,y,E+O,B,B+w,w):B-(o+n/2)+O/2,T="start"===a?W-c-v:"center"===a?W-(c+r/2)+$/2:"end"===a?W-s+C+$:M(c,s,r,v,C+$,W,W+I,I);const{scrollLeft:e,scrollTop:i}=t;S=0===L?0:Math.max(0,Math.min(i+S/L,t.scrollHeight-n/L+O)),T=0===H?0:Math.max(0,Math.min(e+T/H,t.scrollWidth-r/H+$)),B+=i-S,W+=e-T}j.push({el:t,top:S,left:T})}return j};function k(e,t){if(!e.isConnected||!(e=>{let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1})(e))return;const n=(e=>{const t=window.getComputedStyle(e);return{top:parseFloat(t.scrollMarginTop)||0,right:parseFloat(t.scrollMarginRight)||0,bottom:parseFloat(t.scrollMarginBottom)||0,left:parseFloat(t.scrollMarginLeft)||0}})(e);if((e=>"object"==typeof e&&"function"==typeof e.behavior)(t))return t.behavior(I(e,t));const r="boolean"==typeof t||null==t?void 0:t.behavior;for(const{el:o,top:s,left:i}of I(e,(e=>!1===e?{block:"end",inline:"nearest"}:(e=>e===Object(e)&&0!==Object.keys(e).length)(e)?e:{block:"start",inline:"nearest"})(t))){const e=s-n.top+n.bottom,t=i-n.left+n.right;o.scroll({top:e,left:t,behavior:r})}}let x;const N=()=>(x||(x="performance"in window?performance.now.bind(performance):Date.now),x());function R(e){const t=N(),n=Math.min((t-e.startTime)/e.duration,1),r=e.ease(n),o=e.startX+(e.x-e.startX)*r,s=e.startY+(e.y-e.startY)*r;e.method(o,s,n,r),o!==e.x||s!==e.y?requestAnimationFrame((()=>R(e))):e.cb()}function S(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e=>1+--e*e*e*e*e,s=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0;const l=e,a=e.scrollLeft,u=e.scrollTop;R({scrollable:l,method:(t,n,r,o)=>{const s=Math.ceil(t),l=Math.ceil(n);e.scrollLeft=s,e.scrollTop=l,null==i||i({target:e,elapsed:r,value:o,left:s,top:l})},startTime:N(),startX:a,startY:u,x:t,y:n,duration:r,ease:o,cb:s})}const T=function(e,t){const n=t||{};return(e=>e&&!e.behavior||"smooth"===e.behavior)(n)?k(e,{block:n.block,inline:n.inline,scrollMode:n.scrollMode,boundary:n.boundary,skipOverflowHiddenElements:n.skipOverflowHiddenElements,behavior:e=>Promise.all(e.reduce(((e,t)=>{let{el:r,left:o,top:s}=t;const i=r.scrollLeft,l=r.scrollTop;return i===o&&l===s?e:[...e,new Promise((e=>S(r,o,s,n.duration,n.ease,(()=>e({el:r,left:[i,o],top:[l,s]})),n.onScrollChange)))]}),[]))}):Promise.resolve(k(e,t))},$=e=>Object.values(e).map((e=>e.current)).filter(Boolean);function O(e,t,n,r,o,s){var i;const l=(null===(i=null==e?void 0:e.entry)||void 0===i?void 0:i.target)||e;if(!l)return;const a={behavior:t||"smooth",inline:n||"end",block:r||"nearest"};return s?l.scrollIntoView(a):T(l,Object.assign(Object.assign({},o),a))}const B=e=>document.querySelector(`[${d}='${e}']`),W=e=>document.querySelector(`[${h}='${e}']`);function j(t){return e.isValidElement(t)&&t||"function"==typeof t&&e.createElement(t,null)||!!t&&"object"==typeof t&&e.createElement(t,null)||null}const H=e=>{var t;return String((null===(t=null==e?void 0:e.props)||void 0===t?void 0:t[c])||((null==e?void 0:e.key)||v).replace(/^\.\$/,v))};function L(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"current")}var U=e.memo((function({children:t,className:n,id:r,index:o,refs:s}){const i=e.useRef(null);return s[String(o)]=i,e.createElement("div",{className:n,[d]:r,[h]:o,ref:i},t)}));function V({children:t,itemClassName:r=v,refs:o}){const s=e.Children.toArray(t).filter(Boolean),i=e.useMemo((()=>`${n} ${r}`),[r]);return s.map(((t,n)=>{const r=H(t);return e.createElement(U,{className:i,id:r,key:r,refs:o,index:n},t)}))}function A({className:t=v,children:n,onScroll:o=(()=>{}),scrollRef:s,containerRef:i}){const l=e.useMemo((()=>`${r} ${t}`),[t]),a=e.useCallback((e=>{L(s)?s.current=e:s(e),L(i)?i.current=e:i(e)}),[s,i]);return e.createElement("div",{className:l,onScroll:o,ref:a},n)}const P=e.createContext({});const F=e=>{var t;const n=e[Math.floor(e.length/2)];return{first:null==e?void 0:e[0],center:n,last:null===(t=e.slice(-1))||void 0===t?void 0:t[0]}},D="undefined"!=typeof window?e.useLayoutEffect:e.useEffect;function X({items:t,itemsChanged:n,refs:r,options:o,wrapperVisible:s}){const i=e.useRef(),{schedule:l,add:a,addPriority:u,cleanup:c}=Y(t,s),d=e.useCallback((e=>{const t=function(e,t){return[...e].map((e=>{var n,r,o,s;const i=e.target,l=String(null!==(r=null===(n=null==i?void 0:i.dataset)||void 0===n?void 0:n.key)&&void 0!==r?r:v);return[l,{index:String(null!==(s=null===(o=null==i?void 0:i.dataset)||void 0===o?void 0:o.index)&&void 0!==s?s:v),key:l,entry:e,visible:e.intersectionRatio>=t.ratio}]}))}(e,o);s.current?u(t):a(t),l()}),[o,s,u,l,a]);D((()=>{const e=$(r),t=i.current||new IntersectionObserver(d,o);return i.current=t,e.forEach((e=>t.observe(e))),()=>{t.disconnect(),i.current=void 0,c()}}),[d,n,o,r,c])}const Y=(t,n)=>{const r=e.useRef([]),o=e.useRef([]),s=e.useRef(0),i=e.useRef(!1),l=e.useCallback((()=>n.current),[n]),a=e.useCallback((()=>{clearTimeout(s.current),i.current=!1}),[s,i]),u=e.useCallback((()=>{if(!l())return a(),void c();t.setBatch(_(r.current,q(o.current)))}),[a,r,o,l,t]),c=e.useCallback((()=>{i.current||(i.current=!0,s.current=setTimeout((()=>{u(),r.current=[],o.current=[],i.current=!1}),l()?0:100))}),[u,o,r,l]),d=e.useCallback((()=>{a(),r.current=[],o.current=[]}),[o,r,a]),h=e.useCallback((e=>{a(),r.current.push(...e),c()}),[r,c,a]),f=e.useCallback((e=>{a(),o.current.push(...e),c()}),[o,c,a]);return{schedule:c,add:h,addPriority:f,running:i,cleanup:d}},_=(e,t)=>q(e).filter((e=>!t.find((t=>t[0]===e[0])))).concat(t),q=e=>{const t=[];return e.reverse().forEach((e=>{t.find((t=>t[0]===e[0]))||t.push(e)})),t.reverse()},z=t=>e.Children.toArray(t).map(H).filter(Boolean);const K={ratio:.9,rootMargin:"5px",threshold:[.05,.5,.75,.95]};function G(e,t){return{prev:()=>function(e,t){const n=e.findIndex((e=>e===(null==t?void 0:t[0]))),r=t.length,o=n-r,s=o<0,i=s?0:o,l=e.slice(i,s?r:n);return l.length===r?l:e.slice(n,r)}(e,t),next:()=>function(e,t){const n=e.findIndex((e=>{var n;return e===(null===(n=t.slice(-1))||void 0===n?void 0:n[0])})),r=t.length,o=n+r+1,s=o>e.length-1,i=s?e.length-1:o,l=e.slice(s?i-r+1:n+1,i);return l.length===r?l:e.slice(e.length-r,e.length+r)}(e,t)}}const J={current:{}},Q=()=>{};function Z({LeftArrow:t,RightArrow:n,children:r,Header:c,Footer:d,transitionDuration:h=500,transitionBehavior:p,onInit:b=Q,onUpdate:y=Q,onMouseDown:w,onMouseLeave:C,onMouseUp:M,onMouseMove:E,onScroll:I=Q,onTouchMove:k,onTouchStart:x,onTouchEnd:N,onWheel:R=Q,options:S=K,scrollContainerClassName:T=v,containerRef:$=m,itemClassName:H=v,wrapperClassName:U=v,apiRef:F=J,RTL:Y,noPolyfill:_}){const q=j(t),G=j(n),Z=j(c),ee=j(d),te=e.useRef(null),[ne]=e.useState({}),re=e.useMemo((()=>Object.assign(Object.assign(Object.assign({},K),S),{root:te.current})),[S]),oe=e.useRef(new g).current,se=function(t,n){const[r,o]=e.useState(v),s=e.useMemo((()=>z(t)),[t]);return e.useEffect((()=>{const e=s.filter(Boolean).join(v);n.toItems().filter((e=>!s.includes(e))).forEach((e=>{n.delete(e)})),o(e)}),[s,n]),r}(r,oe),ie=e.useRef(null),le=((t,n)=>{const r=e.useRef(!0),o=e.useMemo((()=>n+.01),[n]),s=e.useMemo((()=>[o-.01,o,o+.01]),[o]),i=e.useCallback((e=>{var t;const n=(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.intersectionRatio)>o;r.current!==n&&(r.current=n)}),[o]);return D((()=>{const e=new IntersectionObserver(i,{threshold:s});return t.current&&e.observe(t.current),()=>{e.disconnect()}}),[r,t,i,s]),r})(ie,re.ratio);X(e.useMemo((()=>({items:oe,itemsChanged:se,options:re,refs:ne,wrapperVisible:le})),[oe,se,le,ne,re]));const ae=e.useMemo((()=>function(t,n,r){var o,s,i;const l=!!(null===(o=t.first())||void 0===o?void 0:o.visible),a=!!(null===(s=t.last())||void 0===s?void 0:s.visible),u=e=>{var n;return null===(n=t.find((t=>t[1].key===String(e))))||void 0===n?void 0:n[1]},c=()=>{var e,n;const r=null===(n=null===(e=t.getVisible())||void 0===e?void 0:e[0])||void 0===n?void 0:n[1];return r?t.prev(r):void 0},d=()=>{var e;const n=null===(e=t.getVisible().findLast((()=>!0)))||void 0===e?void 0:e[1];return n?t.next(n):void 0},h=null===(i=null==n?void 0:n.boundary)||void 0===i?void 0:i.current;return{getItemById:u,getItemElementById:B,getItemByIndex:e=>{var n;return null===(n=t.find((t=>String(t[1].index)===String(e))))||void 0===n?void 0:n[1]},getItemElementByIndex:W,getNextElement:d,getPrevElement:c,isFirstItemVisible:l,isItemVisible:e=>t.getVisible().map((e=>e[0])).includes(String(e)),isLastItem:e=>t.last()===u(e),isLastItemVisible:a,scrollNext:(e,t,o,{duration:s,boundary:i=h}={})=>{const l=null!=e?e:null==n?void 0:n.behavior;return O(d(),l,t||"start",o||"nearest",{boundary:i,duration:null!=s?s:null==n?void 0:n.duration},r)},scrollPrev:(e,t,o,{duration:s,boundary:i=h}={})=>{const l=null!=e?e:null==n?void 0:n.behavior;return O(c(),l,t||"end",o||"nearest",{boundary:i,duration:null!=s?s:null==n?void 0:n.duration},r)},useIsVisible:(n,r=!1)=>{const[o,s]=e.useState(r),i=e.useCallback((e=>{s(!!(null==e?void 0:e.visible))}),[]);return e.useEffect((()=>(t.subscribe(n,i),()=>{t.unsubscribe(n,i)})),[n,i]),o},scrollToItem:(e,t,o,s,i)=>{var l;return O(e,null!=t?t:null==n?void 0:n.behavior,o,s,Object.assign(Object.assign({boundary:h},i),{duration:null!==(l=null==i?void 0:i.duration)&&void 0!==l?l:null==n?void 0:n.duration}),r)}}}(oe,{duration:h,behavior:p,boundary:te},_)),[oe,h,p,_]),ue=e.useCallback((()=>Object.assign(Object.assign({},ae),{items:oe,scrollContainer:te})),[ae,oe,te]),[ce,de]=e.useState((()=>ue()));(({context:t,onInit:n,onUpdate:r})=>{const o=e.useCallback((()=>n(t)),[n,t]),s=e.useCallback((()=>r(t)),[r,t]),{items:i}=t;e.useEffect((()=>(i.subscribe(f.onInit,o),i.subscribe(f.onUpdate,s),()=>{i.unsubscribe(f.onInit,o),i.unsubscribe(f.onUpdate,s)})),[i,o,s])})({context:ce,onInit:b,onUpdate:y}),e.useEffect((()=>de(ue())),[ue]),e.useEffect((()=>{L(F)?F.current=ce:F(ce)}),[ce,F]);const he=e.useCallback((e=>I(ce,e)),[I,ce]),fe=e.useCallback((e=>R(ce,e)),[R,ce]),ve=e.useMemo((()=>`${o} ${U}`),[U]),me=e.useMemo((()=>`${T}${Y?" rtl":v}`),[Y,T]);return e.createElement("div",{className:ve,onWheel:fe,onMouseDown:null==w?void 0:w(ce),onMouseLeave:null==C?void 0:C(ce),onMouseUp:null==M?void 0:M(ce),onMouseMove:null==E?void 0:E(ce),onTouchStart:null==x?void 0:x(ce),onTouchMove:null==k?void 0:k(ce),onTouchEnd:null==N?void 0:N(ce),ref:ie},e.createElement(P.Provider,{value:ce},e.createElement("div",{className:i},Z),e.createElement("div",{className:s},e.createElement("div",{className:l},q),e.createElement(A,{className:me,onScroll:he,scrollRef:te,containerRef:$},e.createElement(V,{refs:ne,itemClassName:H},r)),e.createElement("div",{className:a},G)),e.createElement("div",{className:u},ee)))}export{Z as ScrollMenu,P as VisibilityContext,p as constants,F as getItemsPos,G as slidingWindow};
